import{r as l,y as c,j as e,d as R,a1 as N,a2 as T,k as q,S as G}from"./index-EA6D6TNn.js";import{U as b,E as y}from"./user-BClRzq_l.js";import{A as K}from"./alert-circle-zENronei.js";import{P as M}from"./pen-square-BCTdqHxf.js";import{S as O}from"./save-C6fCYDQL.js";import{C as Z}from"./calendar-CQNkWl_0.js";import{E as v}from"./eye-CLpL5osf.js";import{K as $}from"./key-B88qYhY3.js";const Y=()=>{const[a,w]=l.useState(null),[m,n]=l.useState(!0),[P,i]=l.useState(null),[_,d]=l.useState(null),[C,x]=l.useState(!1),[u,f]=l.useState({}),[F,h]=l.useState(!1),[r,o]=l.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[t,j]=l.useState({current:!1,new:!1,confirm:!1});l.useEffect(()=>{S()},[]);const S=async()=>{try{if(n(!0),i(null),!c){const A={id:"1",email:"user@example.com",full_name:"John Doe",avatar_url:null,created_at:"2023-01-01T00:00:00.000Z",last_sign_in_at:"2023-06-15T10:30:00.000Z",role:"user",status:"active"};w(A),f(A),n(!1);return}const{data:{user:s}}=await c.auth.getUser();if(!s)throw new Error("User not found");const{data:k,error:g}=await c.from("profiles").select("*").eq("id",s.id).single();if(g&&g.code!=="PGRST116")throw g;const{data:U,error:p}=await c.from("user_roles").select("*").eq("user_id",s.id).single();if(p&&p.code!=="PGRST116")throw p;const D={id:s.id,email:s.email||"",full_name:k?.full_name||null,avatar_url:k?.avatar_url||null,created_at:s.created_at,last_sign_in_at:s.last_sign_in_at,role:U?.role||"user",status:U?.status||"active"};w(D),f(D)}catch(s){console.error("Error fetching user profile:",s),i("Failed to load user profile")}finally{n(!1)}},I=async()=>{try{if(n(!0),i(null),d(null),!a)return;if(!c){w({...a,...u}),x(!1),d("Profile updated successfully"),n(!1);return}const{error:s}=await c.from("profiles").upsert({id:a.id,full_name:u.full_name,updated_at:new Date().toISOString()});if(s)throw s;await S(),x(!1),d("Profile updated successfully")}catch(s){console.error("Error updating profile:",s),i("Failed to update profile")}finally{n(!1)}},L=async()=>{try{if(n(!0),i(null),d(null),r.newPassword!==r.confirmPassword){i("New passwords do not match");return}if(r.newPassword.length<8){i("Password must be at least 8 characters long");return}if(!c){h(!1),o({currentPassword:"",newPassword:"",confirmPassword:""}),d("Password changed successfully"),n(!1);return}const{error:s}=await c.auth.updateUser({password:r.newPassword});if(s)throw s;h(!1),o({currentPassword:"",newPassword:"",confirmPassword:""}),d("Password changed successfully")}catch(s){console.error("Error changing password:",s),i("Failed to change password")}finally{n(!1)}},E=s=>s?new Date(s).toLocaleString():"Never";return m&&!a?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card shadow-md border-blue-200",children:e.jsx("div",{className:"card-header bg-gradient-to-r from-blue-50 to-blue-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"My Profile"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"View and manage your account information"})]}),e.jsx(b,{className:"h-12 w-12 text-blue-600"})]})})}),_&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded relative",children:[e.jsxs("div",{className:"flex",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),e.jsx("span",{children:_})]}),e.jsx("button",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",onClick:()=>d(null),children:e.jsx(N,{className:"h-5 w-5 text-green-600"})})]}),P&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded relative",children:[e.jsxs("div",{className:"flex",children:[e.jsx(K,{className:"h-5 w-5 mr-2"}),e.jsx("span",{children:P})]}),e.jsx("button",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",onClick:()=>i(null),children:e.jsx(N,{className:"h-5 w-5 text-red-600"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Profile Information"}),C?e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:()=>{x(!1),f(a||{})},children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("button",{className:"btn btn-primary",onClick:I,disabled:m,children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Save"]})]}):e.jsxs("button",{className:"btn btn-secondary",onClick:()=>x(!0),children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Edit Profile"]})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsx("div",{className:"flex-shrink-0 mb-4 md:mb-0 md:mr-6",children:e.jsx("div",{className:"h-32 w-32 rounded-full bg-blue-100 flex items-center justify-center text-blue-600",children:e.jsx(b,{className:"h-16 w-16"})})}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mb-1",children:[e.jsx(T,{className:"h-4 w-4 mr-1"}),"Email"]}),e.jsx("div",{className:"text-lg font-medium text-gray-900",children:a?.email})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mb-1",children:[e.jsx(b,{className:"h-4 w-4 mr-1"}),"Full Name"]}),C?e.jsx("input",{type:"text",className:"form-input",value:u.full_name||"",onChange:s=>f({...u,full_name:s.target.value})}):e.jsx("div",{className:"text-lg font-medium text-gray-900",children:a?.full_name||"Not set"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mb-1",children:[e.jsx(Z,{className:"h-4 w-4 mr-1"}),"Account Created"]}),e.jsx("div",{className:"text-lg font-medium text-gray-900",children:a?.created_at?E(a.created_at):"Unknown"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mb-1",children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Last Login"]}),e.jsx("div",{className:"text-lg font-medium text-gray-900",children:a?.last_sign_in_at?E(a.last_sign_in_at):"Never"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mb-1",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Role"]}),e.jsx("div",{className:"text-lg font-medium text-gray-900",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${a?.role==="admin"?"bg-purple-100 text-purple-800":a?.role==="manager"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:a?.role||"User"})})]})]})]})})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Security"})}),e.jsx("div",{className:"card-body",children:F?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:t.current?"text":"password",className:"form-input pr-10",value:r.currentPassword,onChange:s=>o({...r,currentPassword:s.target.value})}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>j({...t,current:!t.current}),children:t.current?e.jsx(y,{className:"h-5 w-5 text-gray-400"}):e.jsx(v,{className:"h-5 w-5 text-gray-400"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:t.new?"text":"password",className:"form-input pr-10",value:r.newPassword,onChange:s=>o({...r,newPassword:s.target.value})}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>j({...t,new:!t.new}),children:t.new?e.jsx(y,{className:"h-5 w-5 text-gray-400"}):e.jsx(v,{className:"h-5 w-5 text-gray-400"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:t.confirm?"text":"password",className:"form-input pr-10",value:r.confirmPassword,onChange:s=>o({...r,confirmPassword:s.target.value})}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>j({...t,confirm:!t.confirm}),children:t.confirm?e.jsx(y,{className:"h-5 w-5 text-gray-400"}):e.jsx(v,{className:"h-5 w-5 text-gray-400"})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{h(!1),o({currentPassword:"",newPassword:"",confirmPassword:""})},children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:L,disabled:m||!r.currentPassword||!r.newPassword||!r.confirmPassword,children:m?"Saving...":"Change Password"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Password"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Change your account password"})]}),e.jsxs("button",{className:"btn btn-secondary",onClick:()=>h(!0),children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Change"]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Account Status"}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${a?.status==="active"?"bg-green-100 text-green-800":a?.status==="suspended"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:a?.status||"Unknown"})})]})]})})]})})]})]})};export{Y as default};
